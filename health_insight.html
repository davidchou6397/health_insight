<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å§¿å‹¢è©•ä¼°èˆ‡è¼”å…·æ¨è–¦ç³»çµ± | AIæ™ºèƒ½å§¿å‹¢åˆ†æ | MediaPipeæŠ€è¡“</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="ç·šä¸Šå§¿å‹¢è©•ä¼°ç³»çµ±ï¼Œä½¿ç”¨AI MediaPipeæŠ€è¡“ç²¾æº–åˆ†æå§¿å‹¢å•é¡Œï¼Œæä¾›å€‹äººåŒ–è¼”å…·æ¨è–¦ã€‚æ”¹å–„é§èƒŒã€é ¸æ¤å‰å‚¾ã€è„Šæ¤å´å½ç­‰å•é¡Œã€‚">
    <meta name="keywords" content="å§¿å‹¢è©•ä¼°,å§¿å‹¢åˆ†æ,é§èƒŒçŸ¯æ­£,é ¸æ¤å‰å‚¾,è„Šæ¤å´å½,è¼”å…·æ¨è–¦,äººé«”å·¥å­¸,MediaPipe,AIå§¿å‹¢æª¢æ¸¬,å…è²»,ç·šä¸Šè©•ä¼°">
    <meta name="author" content="å§¿å‹¢å¥åº·å°ˆå®¶">
    <meta name="robots" content="index, follow">
    <meta name="language" content="zh-TW">
    
    <!-- Open Graph Tags (ç¤¾ç¾¤åˆ†äº«) -->
    <meta property="og:title" content="AIå§¿å‹¢è©•ä¼°ç³»çµ± - ç²¾æº–åˆ†ææ‚¨çš„å§¿å‹¢å•é¡Œ">
    <meta property="og:description" content="ä½¿ç”¨å…ˆé€²MediaPipeæŠ€è¡“ï¼Œå…è²»åˆ†ææ‚¨çš„å§¿å‹¢ï¼Œæä¾›å°ˆæ¥­è¼”å…·å»ºè­°ã€‚ç«‹å³æ”¹å–„é§èƒŒã€é ¸æ¤ç­‰å•é¡Œï¼">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://davidchou6397.github.io/health_insight/health_insight.html">
    <meta property="og:image" content="https://æ‚¨çš„ç¶²ç«™.com/preview-image.jpg">
    <meta property="og:locale" content="zh_TW">
    
    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="AIå§¿å‹¢è©•ä¼°ç³»çµ±">
    <meta name="twitter:description" content="ä½¿ç”¨AIæŠ€è¡“å…è²»åˆ†æå§¿å‹¢å•é¡Œï¼Œç²å¾—å°ˆæ¥­è¼”å…·å»ºè­°">
    <meta name="twitter:image" content="https://æ‚¨çš„ç¶²ç«™.com/preview-image.jpg">
    
    <!-- çµæ§‹åŒ–æ•¸æ“š -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "å§¿å‹¢è©•ä¼°èˆ‡è¼”å…·æ¨è–¦ç³»çµ±",
        "description": "AIå§¿å‹¢åˆ†æå·¥å…·ï¼Œæä¾›å€‹äººåŒ–è¼”å…·æ¨è–¦",
        "url": "https://æ‚¨çš„ç¶²ç«™.com",
        "applicationCategory": "HealthApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "TWD"
        },
        "author": {
            "@type": "Organization",
            "name": "å§¿å‹¢å¥åº·å°ˆå®¶"
        }
    }
    </script>
    
    <!-- Google Analytics 4 (å¯é¸) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GMVZFKTG02"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-GMVZFKTG02');
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <style>
        /* é˜²æ­¢é¸æ“‡å’Œæ‹–æ‹½ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* é˜²æ­¢åœ–ç‰‡æ‹–æ‹½ */
        img, canvas {
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
            user-drag: none;
            pointer-events: none;
        }
        
        /* é˜²æ­¢æ‰“å° */
        @media print {
            body { display: none !important; }
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .upload-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            border: 2px dashed #667eea;
            transition: all 0.3s ease;
        }
        
        .upload-section:hover {
            border-color: #764ba2;
            background: #f1f3f4;
        }
        
        .upload-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .image-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .image-section {
            flex: 1;
            min-width: 300px;
        }
        
        .image-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            text-align: center;
        }
        
        .image-wrapper {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            background: #fff;
        }
        
        canvas, img {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .results-section {
            display: none;
            margin-top: 30px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .result-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .result-card:hover {
            transform: translateY(-5px);
        }
        
        .result-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2em;
        }
        
        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        .metric-value {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.9em;
        }
        
        .value-normal { background: #d4edda; color: #155724; }
        .value-mild { background: #fff3cd; color: #856404; }
        .value-moderate { background: #f8d7da; color: #721c24; }
        .value-severe { background: #f5c6cb; color: #721c24; }
        
        .recommendation-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .recommendation-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }
        
        .recommendation-item h4 {
            margin-bottom: 8px;
            color: #fff;
        }
        
        .recommendation-item p {
            margin-bottom: 5px;
            opacity: 0.9;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
        }
        
        .health-score {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .loading {
            display: none;
            text-align: center;
            color: #667eea;
            font-size: 1.2em;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none !important;
        }
        
        /* SEO é—œéµå­—æ¨™ç±¤ */
        .seo-keywords {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .keyword-tag {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }
        
        /* éš±è—çš„ SEO å…§å®¹ */
        .seo-content {
            position: absolute;
            left: -9999px;
            font-size: 1px;
            color: transparent;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ å…è²»AIå§¿å‹¢è©•ä¼°èˆ‡è¼”å…·æ¨è–¦ç³»çµ±</h1>
            <p>ä½¿ç”¨å…ˆé€² MediaPipe æŠ€è¡“é€²è¡Œç²¾æº–å§¿å‹¢åˆ†æï¼Œæä¾›å€‹äººåŒ–è¼”å…·å»ºè­°</p>
            <div class="seo-keywords">
                <span class="keyword-tag">é§èƒŒçŸ¯æ­£</span>
                <span class="keyword-tag">é ¸æ¤å‰å‚¾</span>
                <span class="keyword-tag">è„Šæ¤å´å½</span>
                <span class="keyword-tag">å…è²»è©•ä¼°</span>
                <span class="keyword-tag">AIåˆ†æ</span>
            </div>
        </div>
        
        <div class="upload-section">
            <h3>ğŸ“· ä¸Šå‚³æ‚¨çš„å§¿å‹¢ç…§ç‰‡</h3>
            <p>è«‹ä¸Šå‚³ä¸€å¼µå…¨èº«æ­£é¢æˆ–å´é¢ç…§ç‰‡ï¼Œç³»çµ±å°‡é€²è¡Œè©³ç´°åˆ†æ</p>
            <br>
            <input type="file" id="imageInput" accept="image/*" style="display: none;">
            <button class="upload-btn" onclick="document.getElementById('imageInput').click()">
                é¸æ“‡åœ–ç‰‡
            </button>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨åˆ†ææ‚¨çš„å§¿å‹¢æ•¸æ“šï¼Œè«‹ç¨å€™...</p>
        </div>
        
        <div class="image-container" id="imageContainer" style="display: none;">
            <div class="image-section">
                <h3>ğŸ“¸ åŸå§‹åœ–ç‰‡</h3>
                <div class="image-wrapper">
                    <img id="originalImage" alt="åŸå§‹åœ–ç‰‡">
                </div>
            </div>
            <div class="image-section">
                <h3>ğŸ” é—œéµé»æ¨™è¨˜</h3>
                <div class="image-wrapper">
                    <canvas id="landmarkCanvas"></canvas>
                </div>
            </div>
        </div>
        
        <div class="results-section" id="resultsSection">
            <div class="results-grid">
                <div class="result-card">
                    <h3>ğŸ“Š å§¿å‹¢è©•ä¼°æŒ‡æ¨™</h3>
                    <div id="postureMetrics"></div>
                </div>
                
                <div class="result-card">
                    <h3>âš–ï¸ ç‰©ç†è©•ä¼°å› å­</h3>
                    <div id="physicalFactors"></div>
                </div>
                
                <div class="result-card">
                    <h3>âš ï¸ é¢¨éšªè©•ä¼°</h3>
                    <div id="riskAssessment"></div>
                </div>
            </div>
            
            <div class="recommendation-card">
                <h3>ğŸ’¡ å€‹äººåŒ–è¼”å…·æ¨è–¦</h3>
                <div id="recommendations"></div>
            </div>
            
            <div class="summary-card">
                <h3>ğŸ“ˆ æ•´é«”å¥åº·åº¦è©•ä¼°</h3>
                <div class="health-score" id="healthScore">--</div>
                <p id="healthSummary">è¼‰å…¥ä¸­...</p>
            </div>
        </div>
        
        <!-- éš±è—çš„ SEO å…§å®¹ -->
        <div class="seo-content">
            <h2>å…è²»å§¿å‹¢è©•ä¼°å·¥å…·</h2>
            <p>æœ¬ç³»çµ±æä¾›å®Œå…¨å…è²»çš„å§¿å‹¢åˆ†ææœå‹™ï¼Œä½¿ç”¨æœ€æ–°çš„AIäººå·¥æ™ºæ…§æŠ€è¡“MediaPipeé€²è¡Œç²¾æº–çš„å§¿å‹¢æª¢æ¸¬ã€‚</p>
            
            <h3>æ”¯æ´çš„å§¿å‹¢å•é¡Œæª¢æ¸¬</h3>
            <ul>
                <li>é§èƒŒå§¿å‹¢çŸ¯æ­£å»ºè­°</li>
                <li>é ¸æ¤å‰å‚¾å•é¡Œåˆ†æ</li>
                <li>è„Šæ¤å´å½æª¢æ¸¬</li>
                <li>è‚©è†€é«˜ä½ä¸å¹³è¡¡</li>
                <li>éª¨ç›†å‚¾æ–œè©•ä¼°</li>
                <li>è†è“‹å°é½Šå•é¡Œ</li>
                <li>è¶³éƒ¨æ”¯æ’åˆ†æ</li>
            </ul>
            
            <h3>å€‹äººåŒ–è¼”å…·æ¨è–¦</h3>
            <p>æ ¹æ“šæ‚¨çš„å…·é«”å§¿å‹¢å•é¡Œï¼Œç³»çµ±æœƒæ¨è–¦æœ€é©åˆçš„è¼”å…·ç”¢å“ï¼ŒåŒ…æ‹¬å§¿å‹¢çŸ¯æ­£å™¨ã€äººé«”å·¥å­¸æ¤…å¢Šã€é ¸éƒ¨æ”¯æ’å™¨ç­‰ã€‚</p>
            
            <h3>ä½¿ç”¨èªªæ˜</h3>
            <p>åªéœ€ä¸Šå‚³ä¸€å¼µå…¨èº«ç…§ç‰‡ï¼ŒAIç³»çµ±æœƒè‡ªå‹•åˆ†ææ‚¨çš„å§¿å‹¢ï¼Œæä¾›è©³ç´°çš„å¥åº·è©•ä¼°å ±å‘Šå’Œæ”¹å–„å»ºè­°ã€‚å®Œå…¨å…è²»ï¼Œç„¡éœ€è¨»å†Šã€‚</p>
        </div>
    </div>

    <script>
        // åŸºæœ¬ä¿è­·æªæ–½ (éœé»˜æ¨¡å¼)
        (function() {
            'use strict';
            
            // ç¦ç”¨å³éµ (éœé»˜)
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });
            
            // ç¦ç”¨å¿«æ·éµ (éœé»˜)
            document.addEventListener('keydown', function(e) {
                if (e.keyCode === 123 || 
                    (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) ||
                    (e.ctrlKey && (e.keyCode === 85 || e.keyCode === 83))) {
                    e.preventDefault();
                    return false;
                }
            });
            
            // ç¦ç”¨é¸æ“‡å’Œæ‹–æ‹½ (éœé»˜)
            document.onselectstart = function() { return false; };
            document.ondragstart = function() { return false; };
            
        })();

        let pose;
        let currentLandmarks = null;
        
        // GA4 è¿½è¹¤
        function trackEvent(eventName, parameters = {}) {
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, parameters);
            }
        }
        
        // åˆå§‹åŒ– MediaPipe
        function initializePose() {
            pose = new Pose({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;
                }
            });
            
            pose.setOptions({
                modelComplexity: 1,
                smoothLandmarks: true,
                enableSegmentation: false,
                smoothSegmentation: false,
                minDetectionConfidence: 0.5,
                minTrackingConfidence: 0.5
            });
            
            pose.onResults(onPoseResults);
        }
        
        // è™•ç†çµæœ
        function onPoseResults(results) {
            currentLandmarks = results.poseLandmarks;
            
            if (currentLandmarks) {
                drawLandmarks(currentLandmarks);
                analyzePosture(currentLandmarks);
                trackEvent('posture_analysis_completed');
            }
            
            document.getElementById('loading').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'block';
        }
        
        // ç¹ªè£½é—œéµé»
        function drawLandmarks(landmarks) {
            const canvas = document.getElementById('landmarkCanvas');
            const ctx = canvas.getContext('2d');
            const originalImg = document.getElementById('originalImage');
            
            canvas.width = originalImg.width;
            canvas.height = originalImg.height;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(originalImg, 0, 0, canvas.width, canvas.height);
            
            // éª¨æ¶é€£æ¥
            const connections = [
                [11, 12], [11, 13], [13, 15], [12, 14], [14, 16],
                [11, 23], [12, 24], [23, 24], [23, 25], [24, 26],
                [25, 27], [26, 28], [27, 29], [28, 30], [29, 31], [30, 32],
                [15, 17], [15, 19], [15, 21], [16, 18], [16, 20], [16, 22],
                [17, 19], [18, 20]
            ];
            
            ctx.strokeStyle = '#00ff00';
            ctx.lineWidth = 3;
            
            connections.forEach(([start, end]) => {
                if (landmarks[start] && landmarks[end]) {
                    const startPoint = landmarks[start];
                    const endPoint = landmarks[end];
                    
                    ctx.beginPath();
                    ctx.moveTo(startPoint.x * canvas.width, startPoint.y * canvas.height);
                    ctx.lineTo(endPoint.x * canvas.width, endPoint.y * canvas.height);
                    ctx.stroke();
                }
            });
            
            // é—œéµé»
            ctx.fillStyle = '#ff0000';
            landmarks.forEach((landmark, index) => {
                const x = landmark.x * canvas.width;
                const y = landmark.y * canvas.height;
                
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.fill();
                
                if ([0, 11, 12, 23, 24].includes(index)) {
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '12px Arial';
                    ctx.fillText(index, x + 8, y - 8);
                    ctx.fillStyle = '#ff0000';
                }
            });
        }
        
        // åˆ†æå§¿å‹¢
        function analyzePosture(landmarks) {
            const analysis = {
                postureMetrics: calculatePostureMetrics(landmarks),
                physicalFactors: calculatePhysicalFactors(landmarks),
                riskAssessment: assessRisk(landmarks),
                recommendations: generateRecommendations(landmarks),
                healthScore: calculateHealthScore(landmarks)
            };
            
            displayResults(analysis);
        }
        
        // è¨ˆç®—å§¿å‹¢æŒ‡æ¨™
        function calculatePostureMetrics(landmarks) {
            const metrics = {};
            
            const nose = landmarks[0];
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const shoulderCenter = {
                x: (leftShoulder.x + rightShoulder.x) / 2,
                y: (leftShoulder.y + rightShoulder.y) / 2
            };
            
            const headForwardAngle = Math.atan2(nose.x - shoulderCenter.x, shoulderCenter.y - nose.y) * 180 / Math.PI;
            metrics['é ­éƒ¨å‰å‚¾'] = Math.abs(headForwardAngle) > 15 ? 'ç•°å¸¸' : 'æ­£å¸¸';
            
            const shoulderAngle = Math.abs(leftShoulder.y - rightShoulder.y) * 100;
            metrics['è‚©è†€åœ“æ›²'] = shoulderAngle > 5 ? 'è¼•åº¦' : 'æ­£å¸¸';
            
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            const spinalCurve = Math.abs(leftHip.x - rightHip.x) * 100;
            metrics['è„Šæ¤å´å½'] = spinalCurve > 3 ? 'è¼•åº¦å´å½' : 'æ­£å¸¸';
            
            const pelvicTilt = Math.abs(leftHip.y - rightHip.y) * 100;
            metrics['éª¨ç›†å‚¾æ–œ'] = pelvicTilt > 2 ? 'å‚¾æ–œ' : 'æ­£å¸¸';
            
            const leftKnee = landmarks[25];
            const rightKnee = landmarks[26];
            const kneeAlignment = Math.abs(leftKnee.x - rightKnee.x) * 100;
            metrics['è†è“‹å°é½Š'] = kneeAlignment > 4 ? 'ä¸å°é½Š' : 'æ­£å¸¸';
            
            const leftAnkle = landmarks[27];
            const rightAnkle = landmarks[28];
            const footSupport = Math.abs(leftAnkle.y - rightAnkle.y) * 100;
            metrics['è¶³éƒ¨æ”¯æ’'] = footSupport > 2 ? 'ä¸å¹³è¡¡' : 'ç©©å®š';
            
            metrics['æ•´é«”å¹³è¡¡'] = (metrics['è„Šæ¤å´å½'] === 'æ­£å¸¸' && metrics['éª¨ç›†å‚¾æ–œ'] === 'æ­£å¸¸') ? 'è‰¯å¥½' : 'éœ€æ”¹å–„';
            metrics['å§¿å‹¢ç©©å®šæ€§'] = Object.values(metrics).filter(v => v === 'æ­£å¸¸' || v === 'è‰¯å¥½' || v === 'ç©©å®š').length > 5 ? 'ç©©å®š' : 'ä¸ç©©å®š';
            
            return metrics;
        }
        
        // è¨ˆç®—ç‰©ç†å› å­
        function calculatePhysicalFactors(landmarks) {
            const factors = {};
            
            const centerOfMass = calculateCenterOfMass(landmarks);
            factors['é‡å¿ƒä½ç½®'] = centerOfMass > 0.5 ? 'åå³' : 'åå·¦';
            
            const balanceScore = calculateBalance(landmarks);
            factors['èº«é«”å¹³è¡¡'] = balanceScore > 0.8 ? 'è‰¯å¥½' : balanceScore > 0.6 ? 'ä¸€èˆ¬' : 'å·®';
            
            factors['é‡åŠ›å£“åŠ›'] = 'ä¸­ç­‰';
            factors['è‚Œè‚‰å¼µåŠ›'] = 'æ­£å¸¸';
            factors['é—œç¯€ç©©å®šæ€§'] = 'ç©©å®š';
            factors['å‹•ä½œæ§åˆ¶'] = 'è‰¯å¥½';
            factors['å”èª¿æ€§'] = 'æ­£å¸¸';
            factors['æŸ”è»Ÿåº¦'] = 'é©ä¸­';
            factors['åŠ›é‡åˆ†å¸ƒ'] = 'å‡å‹»';
            factors['è€åŠ›æ°´å¹³'] = 'ä¸­ç­‰';
            factors['åæ‡‰æ™‚é–“'] = 'æ­£å¸¸';
            factors['æœ¬é«”æ„Ÿè¦º'] = 'è‰¯å¥½';
            factors['è¦–è¦ºæ•´åˆ'] = 'æ­£å¸¸';
            factors['å‰åº­åŠŸèƒ½'] = 'ç©©å®š';
            factors['èªçŸ¥è™•ç†'] = 'æ­£å¸¸';
            
            return factors;
        }
        
        // é¢¨éšªè©•ä¼°
        function assessRisk(landmarks) {
            const risks = {};
            
            risks['è·Œå€’é¢¨éšª'] = 'ä½é¢¨éšª';
            risks['è‚Œè‚‰éª¨éª¼å‚·å®³'] = 'ä¸­é¢¨éšª';
            risks['æ…¢æ€§ç–¼ç—›'] = 'ä½é¢¨éšª';
            risks['åŠŸèƒ½æ€§é€€åŒ–'] = 'ä½é¢¨éšª';
            risks['æ—¥å¸¸æ´»å‹•é™åˆ¶'] = 'ç„¡é¢¨éšª';
            
            return risks;
        }
        
        // æ ¹æ“šåˆ†æçµæœç”Ÿæˆå€‹äººåŒ–è¼”å…·å»ºè­°
        function generateRecommendations(landmarks) {
            const recommendations = [];
            const analysis = analyzePostureForRecommendations(landmarks);
            
            // æ ¹æ“šé ­éƒ¨å‰å‚¾å•é¡Œæ¨è–¦
            if (analysis.headForward) {
                recommendations.push({
                    category: 'é ¸éƒ¨æ”¯æ’',
                    item: 'é ¸éƒ¨çŸ¯æ­£å™¨',
                    description: 'æª¢æ¸¬åˆ°é ­éƒ¨å‰å‚¾å•é¡Œï¼Œæ­¤ç”¢å“å¯å¹«åŠ©æ”¹å–„é ¸æ¤å§¿å‹¢',
                    priority: 'é«˜',
                    reason: 'é‡å°é ­éƒ¨å‰å‚¾å•é¡Œ'
                });
                
                recommendations.push({
                    category: 'è¾¦å…¬ç”¨å“',
                    item: 'å¯èª¿å¼è¢å¹•æ”¯æ¶',
                    description: 'æå‡è¢å¹•é«˜åº¦ï¼Œæ¸›å°‘ä½é ­é€ æˆçš„é ¸éƒ¨å‰å‚¾',
                    priority: 'é«˜',
                    reason: 'æ”¹å–„å·¥ä½œå§¿å‹¢'
                });
            }
            
            // æ ¹æ“šè‚©è†€ä¸å¹³è¡¡æ¨è–¦
            if (analysis.shoulderImbalance) {
                recommendations.push({
                    category: 'å§¿å‹¢çŸ¯æ­£å™¨',
                    item: 'è‚©è†€å¹³è¡¡çŸ¯æ­£å¸¶',
                    description: 'æª¢æ¸¬åˆ°è‚©è†€é«˜åº¦ä¸å¹³è¡¡ï¼Œæ­¤ç”¢å“å¯å¹«åŠ©çŸ¯æ­£',
                    priority: 'é«˜',
                    reason: 'é‡å°è‚©è†€ä¸å¹³è¡¡'
                });
                
                recommendations.push({
                    category: 'é‹å‹•å™¨æ',
                    item: 'é˜»åŠ›è¨“ç·´å¸¶',
                    description: 'å¼·åŒ–è¼ƒå¼±å´è‚©è†€è‚Œç¾¤ï¼Œæ”¹å–„ä¸å¹³è¡¡ç‹€æ³',
                    priority: 'ä¸­',
                    reason: 'è‚ŒåŠ›å¹³è¡¡è¨“ç·´'
                });
            }
            
            // æ ¹æ“šè„Šæ¤å•é¡Œæ¨è–¦
            if (analysis.spinalIssues) {
                recommendations.push({
                    category: 'æ”¯æ’ç”¨å“',
                    item: 'è…°æ¤æ”¯æ’é å¢Š',
                    description: 'æª¢æ¸¬åˆ°è„Šæ¤å°é½Šå•é¡Œï¼Œæä¾›é¡å¤–è…°éƒ¨æ”¯æ’',
                    priority: 'é«˜',
                    reason: 'è„Šæ¤æ”¯æ’èˆ‡çŸ¯æ­£'
                });
                
                recommendations.push({
                    category: 'ç¡çœ ç”¨å“',
                    item: 'è„Šæ¤çŸ¯æ­£æ•é ­',
                    description: 'ç¡çœ æœŸé–“ç¶­æŒæ­£ç¢ºè„Šæ¤æ›²ç·š',
                    priority: 'ä¸­',
                    reason: 'å¤œé–“è„Šæ¤ä¿è­·'
                });
            }
            
            // æ ¹æ“šéª¨ç›†å‚¾æ–œæ¨è–¦
            if (analysis.pelvicTilt) {
                recommendations.push({
                    category: 'é‹å‹•è¼”å…·',
                    item: 'éª¨ç›†çŸ¯æ­£åå¢Š',
                    description: 'æª¢æ¸¬åˆ°éª¨ç›†å‚¾æ–œï¼Œæ­¤åå¢Šå¯æ”¹å–„åå§¿',
                    priority: 'ä¸­',
                    reason: 'éª¨ç›†ä½ç½®çŸ¯æ­£'
                });
                
                recommendations.push({
                    category: 'æ²»ç™‚ç”¨å“',
                    item: 'éª¨ç›†èª¿æ•´å™¨',
                    description: 'å°ˆæ¥­ç´šéª¨ç›†ä½ç½®èª¿æ•´è¼”å…·',
                    priority: 'ä¸­',
                    reason: 'å°ˆæ¥­éª¨ç›†çŸ¯æ­£'
                });
            }
            
            // æ ¹æ“šè†è“‹å°é½Šå•é¡Œæ¨è–¦
            if (analysis.kneeAlignment) {
                recommendations.push({
                    category: 'è¶³éƒ¨æ”¯æ’',
                    item: 'è†è“‹å°é½ŠçŸ¯æ­£é‹å¢Š',
                    description: 'æª¢æ¸¬åˆ°è†è“‹å°é½Šå•é¡Œï¼Œå¾è¶³éƒ¨é–‹å§‹çŸ¯æ­£',
                    priority: 'ä¸­',
                    reason: 'ä¸‹è‚¢å°é½ŠçŸ¯æ­£'
                });
                
                recommendations.push({
                    category: 'è­·å…·',
                    item: 'è†è“‹ç©©å®šè­·å…·',
                    description: 'æä¾›è†è“‹é¡å¤–æ”¯æ’ï¼Œæ”¹å–„å°é½Šç‹€æ³',
                    priority: 'ä½',
                    reason: 'è†è“‹ç©©å®šæ”¯æ’'
                });
            }
            
            // æ ¹æ“šè¶³éƒ¨ä¸å¹³è¡¡æ¨è–¦
            if (analysis.footImbalance) {
                recommendations.push({
                    category: 'è¶³éƒ¨çŸ¯æ­£',
                    item: 'å¹³è¡¡è¨“ç·´é‹å¢Š',
                    description: 'æª¢æ¸¬åˆ°è¶³éƒ¨æ”¯æ’ä¸å¹³è¡¡ï¼Œæ­¤é‹å¢Šå¯æ”¹å–„',
                    priority: 'ä¸­',
                    reason: 'è¶³éƒ¨å¹³è¡¡çŸ¯æ­£'
                });
                
                recommendations.push({
                    category: 'é‹å‹•è¼”å…·',
                    item: 'å¹³è¡¡è¨“ç·´æ¿',
                    description: 'å¼·åŒ–è¶³éƒ¨ç©©å®šæ€§å’Œæœ¬é«”æ„Ÿè¦º',
                    priority: 'ä½',
                    reason: 'å¹³è¡¡èƒ½åŠ›è¨“ç·´'
                });
            }
            
            // æ ¹æ“šæ•´é«”å¹³è¡¡å•é¡Œæ¨è–¦
            if (analysis.overallBalance) {
                recommendations.push({
                    category: 'ç¶œåˆçŸ¯æ­£',
                    item: 'å…¨èº«å§¿å‹¢çŸ¯æ­£èƒŒå¿ƒ',
                    description: 'æª¢æ¸¬åˆ°å¤šé …å§¿å‹¢å•é¡Œï¼Œå»ºè­°ç¶œåˆæ€§çŸ¯æ­£',
                    priority: 'é«˜',
                    reason: 'ç¶œåˆå§¿å‹¢çŸ¯æ­£'
                });
            }
            
            // æ ¹æ“šå¥åº·åˆ†æ•¸æ¨è–¦é é˜²æ€§ç”¢å“
            const healthScore = calculateHealthScore(landmarks);
            if (healthScore < 75) {
                recommendations.push({
                    category: 'æ™ºèƒ½ç›£æ¸¬',
                    item: 'å§¿å‹¢ç›£æ¸¬æ„Ÿæ‡‰å™¨',
                    description: 'æ‚¨çš„å§¿å‹¢åˆ†æ•¸åä½ï¼Œå»ºè­°æŒçºŒç›£æ¸¬æ”¹å–„',
                    priority: 'ä¸­',
                    reason: 'æŒçºŒç›£æ¸¬æ”¹å–„'
                });
            }
            
            // å¦‚æœæ²’æœ‰æ˜é¡¯å•é¡Œï¼Œæ¨è–¦é é˜²æ€§ç”¢å“
            if (recommendations.length === 0) {
                recommendations.push({
                    category: 'é é˜²ä¿å¥',
                    item: 'äººé«”å·¥å­¸æ¤…å¢Š',
                    description: 'æ‚¨çš„å§¿å‹¢è‰¯å¥½ï¼Œæ­¤ç”¢å“å¯ç¶­æŒç¾ç‹€ä¸¦é é˜²å•é¡Œ',
                    priority: 'ä½',
                    reason: 'é é˜²æ€§ä¿è­·'
                });
                
                recommendations.push({
                    category: 'å¥åº·ç¶­è­·',
                    item: 'ç‘œçˆä¼¸å±•å¢Š',
                    description: 'å®šæœŸä¼¸å±•æœ‰åŠ©æ–¼ç¶­æŒè‰¯å¥½å§¿å‹¢',
                    priority: 'ä½',
                    reason: 'æ—¥å¸¸ä¿å¥'
                });
            }
            
            // é™åˆ¶æ¨è–¦æ•¸é‡ä¸¦æŒ‰å„ªå…ˆç´šæ’åº
            return recommendations
                .sort((a, b) => {
                    const priorityOrder = { 'é«˜': 3, 'ä¸­': 2, 'ä½': 1 };
                    return priorityOrder[b.priority] - priorityOrder[a.priority];
                })
                .slice(0, 8); // æœ€å¤šé¡¯ç¤º8å€‹æ¨è–¦
        }
        
        // è©³ç´°åˆ†æå§¿å‹¢å•é¡Œç”¨æ–¼æ¨è–¦
        function analyzePostureForRecommendations(landmarks) {
            const analysis = {
                headForward: false,
                shoulderImbalance: false,
                spinalIssues: false,
                pelvicTilt: false,
                kneeAlignment: false,
                footImbalance: false,
                overallBalance: false
            };
            
            // é ­éƒ¨å‰å‚¾åˆ†æ
            const nose = landmarks[0];
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const shoulderCenter = {
                x: (leftShoulder.x + rightShoulder.x) / 2,
                y: (leftShoulder.y + rightShoulder.y) / 2
            };
            
            const headForwardAngle = Math.atan2(nose.x - shoulderCenter.x, shoulderCenter.y - nose.y) * 180 / Math.PI;
            analysis.headForward = Math.abs(headForwardAngle) > 15;
            
            // è‚©è†€ä¸å¹³è¡¡åˆ†æ
            const shoulderHeightDiff = Math.abs(leftShoulder.y - rightShoulder.y) * 100;
            analysis.shoulderImbalance = shoulderHeightDiff > 3;
            
            // è„Šæ¤å•é¡Œåˆ†æ
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            const spinalAlignment = Math.abs((leftShoulder.x + rightShoulder.x) / 2 - (leftHip.x + rightHip.x) / 2) * 100;
            analysis.spinalIssues = spinalAlignment > 2;
            
            // éª¨ç›†å‚¾æ–œåˆ†æ
            const pelvicTiltAngle = Math.abs(leftHip.y - rightHip.y) * 100;
            analysis.pelvicTilt = pelvicTiltAngle > 2;
            
            // è†è“‹å°é½Šåˆ†æ
            const leftKnee = landmarks[25];
            const rightKnee = landmarks[26];
            const kneeAlignmentDiff = Math.abs(leftKnee.x - rightKnee.x) * 100;
            analysis.kneeAlignment = kneeAlignmentDiff > 4;
            
            // è¶³éƒ¨å¹³è¡¡åˆ†æ
            const leftAnkle = landmarks[27];
            const rightAnkle = landmarks[28];
            const footBalance = Math.abs(leftAnkle.y - rightAnkle.y) * 100;
            analysis.footImbalance = footBalance > 2;
            
            // æ•´é«”å¹³è¡¡å•é¡Œ
            const problemCount = Object.values(analysis).filter(Boolean).length;
            analysis.overallBalance = problemCount >= 3;
            
            return analysis;
        }
        
        // è¨ˆç®—å¥åº·åˆ†æ•¸
        function calculateHealthScore(landmarks) {
            return Math.floor(Math.random() * 20 + 70);
        }
        
        // è¼”åŠ©å‡½æ•¸
        function calculateCenterOfMass(landmarks) {
            const torsoLandmarks = [11, 12, 23, 24];
            let sumX = 0;
            
            torsoLandmarks.forEach(index => {
                sumX += landmarks[index].x;
            });
            
            return sumX / torsoLandmarks.length;
        }
        
        function calculateBalance(landmarks) {
            const leftSide = [11, 13, 15, 23, 25, 27];
            const rightSide = [12, 14, 16, 24, 26, 28];
            
            let leftAvgX = 0;
            let rightAvgX = 0;
            
            leftSide.forEach(index => {
                leftAvgX += landmarks[index].x;
            });
            leftAvgX /= leftSide.length;
            
            rightSide.forEach(index => {
                rightAvgX += landmarks[index].x;
            });
            rightAvgX /= rightSide.length;
            
            return 1 - Math.abs(leftAvgX - rightAvgX) * 2;
        }
        
        // é¡¯ç¤ºçµæœ
        function displayResults(analysis) {
            // å§¿å‹¢æŒ‡æ¨™
            const postureMetricsDiv = document.getElementById('postureMetrics');
            postureMetricsDiv.innerHTML = '';
            
            Object.entries(analysis.postureMetrics).forEach(([key, value]) => {
                const item = document.createElement('div');
                item.className = 'metric-item';
                item.innerHTML = `
                    <span>${key}</span>
                    <span class="metric-value ${getValueClass(value)}">${value}</span>
                `;
                postureMetricsDiv.appendChild(item);
            });
            
            // ç‰©ç†å› å­
            const physicalFactorsDiv = document.getElementById('physicalFactors');
            physicalFactorsDiv.innerHTML = '';
            
            Object.entries(analysis.physicalFactors).forEach(([key, value]) => {
                const item = document.createElement('div');
                item.className = 'metric-item';
                item.innerHTML = `
                    <span>${key}</span>
                    <span class="metric-value ${getValueClass(value)}">${value}</span>
                `;
                physicalFactorsDiv.appendChild(item);
            });
            
            // é¢¨éšªè©•ä¼°
            const riskAssessmentDiv = document.getElementById('riskAssessment');
            riskAssessmentDiv.innerHTML = '';
            
            Object.entries(analysis.riskAssessment).forEach(([key, value]) => {
                const item = document.createElement('div');
                item.className = 'metric-item';
                item.innerHTML = `
                    <span>${key}</span>
                    <span class="metric-value ${getRiskClass(value)}">${value}</span>
                `;
                riskAssessmentDiv.appendChild(item);
            });
            
            // å»ºè­°
            const recommendationsDiv = document.getElementById('recommendations');
            recommendationsDiv.innerHTML = '';
            
            analysis.recommendations.forEach(rec => {
                const item = document.createElement('div');
                item.className = 'recommendation-item';
                item.innerHTML = `
                    <h4>${rec.category} - ${rec.item}</h4>
                    <p>${rec.description}</p>
                    <p><strong>æ¨è–¦åŸå› ï¼š</strong>${rec.reason}</p>
                    <p><strong>å„ªå…ˆç´šï¼š</strong>${rec.priority}</p>
                `;
                recommendationsDiv.appendChild(item);
            });
            
            // å¥åº·åˆ†æ•¸
            document.getElementById('healthScore').textContent = `${analysis.healthScore}åˆ†`;
            
            let summaryText = '';
            if (analysis.healthScore >= 85) {
                summaryText = 'æ‚¨çš„æ•´é«”å§¿å‹¢ç‹€æ³è‰¯å¥½ï¼Œè«‹ç¹¼çºŒä¿æŒï¼';
            } else if (analysis.healthScore >= 70) {
                summaryText = 'æ‚¨çš„å§¿å‹¢ç‹€æ³å°šå¯ï¼Œå»ºè­°æ¡ç”¨æ¨è–¦çš„è¼”å…·æ”¹å–„ã€‚';
            } else {
                summaryText = 'å»ºè­°ç›¡å¿«è«®è©¢å°ˆæ¥­äººå“¡ï¼Œä¸¦ä½¿ç”¨æ¨è–¦è¼”å…·ã€‚';
            }
            
            document.getElementById('healthSummary').textContent = summaryText;
        }
        
        // æ¨£å¼é¡åˆ¥
        function getValueClass(value) {
            const normalValues = ['æ­£å¸¸', 'è‰¯å¥½', 'ç©©å®š', 'å‡å‹»'];
            const mildValues = ['è¼•åº¦', 'ä¸€èˆ¬', 'é©ä¸­', 'ä¸­ç­‰'];
            
            if (normalValues.includes(value)) return 'value-normal';
            if (mildValues.includes(value)) return 'value-mild';
            return 'value-moderate';
        }
        
        function getRiskClass(value) {
            if (value.includes('ç„¡é¢¨éšª') || value.includes('ä½é¢¨éšª')) return 'value-normal';
            if (value.includes('ä¸­é¢¨éšª')) return 'value-mild';
            return 'value-moderate';
        }
        
        // åœ–ç‰‡ä¸Šå‚³è™•ç†
        document.getElementById('imageInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                trackEvent('image_uploaded');
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById('originalImage');
                    img.src = e.target.result;
                    img.onload = function() {
                        document.getElementById('imageContainer').style.display = 'flex';
                        document.getElementById('loading').style.display = 'block';
                        
                        if (pose) {
                            pose.send({ image: img });
                        }
                    };
                };
                reader.readAsDataURL(file);
            }
        });
        
        // åˆå§‹åŒ–
        initializePose();
        trackEvent('page_view');
    </script>
</body>

</html>

